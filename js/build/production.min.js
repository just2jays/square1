this.JST=this.JST||{},this.JST["templates/checkin.html"]=function(a){var b,c="";_.escape;return c+='<div class="container">\n    <h2 class="widget-title text-center">Check In Here</h2>\n    <div class="row">\n        <div class="col-md-8 col-md-offset-2">\n            <div class="fetchFromFoursquare">\n                <p class="text-center">In this location, on this day, you did some awesome stuff...</p>\n                <p><button type="button" id="BeginCheckin" class="btn btn-block btn-lg">'+(null==(b=a.search_label)?"":b)+'</button></p>\n                <div class="text-center">\n                    <i class="loading-indicator fa fa-cog fa-spin fa-3x fa-fw"></i>\n                </div>\n                <div class="list-group location-list"></div>\n            </div>\n        </div><!-- col-lg-8 -->\n    </div><!-- row -->\n</div><!-- container -->\n\n<div id="foursquareModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="foursqareModal" aria-hidden="true">\n	<form id="existingLocationForm" role="form" enctype="multipart/form-data">\n		<div class="modal-dialog">\n			<div class="modal-content">\n				<div class="modal-header">\n					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n					<h4 class="existingLocationName modal-title" id="myModalLabel"></h4>\n				</div>\n				<div class="modal-body default-body">\n					<div class="well">\n						<h3></h3>\n					</div>\n					<div class="well">\n						<i class="fa fa-bullhorn"></i> Got something to say?\n						<textarea id="CheckinMessageInput" class="checkinMessageInput form-control" rows="4"></textarea>\n					</div>\n                    <div class="include-checkin-photo form-group">\n                        <label class="include-checkin-photo-btn btn btn-primary btn-lg btn-block">\n                            <i class="fa fa-camera-retro" aria-hidden="true"></i> Include Photo <input id="include_photo_input" name="checkinPhoto" type="file" multiple accept="image/*" style="display: none;">\n                        </label>\n                    </div>\n				</div>\n				<div class="modal-body response-body">\n					<div class="well">\n						<h3></h3>\n					</div>\n					<div class="well prize-well text-center">\n						<i class="fa fa-gift fa-3"></i> Prizes\n\n					</div>\n                    <div class="well money-well text-center"></div>\n				</div>\n				<div class="modal-footer">\n					<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>\n					<button type="submit" class="existing_save btn btn-primary">Here</button>\n				</div>\n			</div>\n		</div>\n	</form>\n</div>\n'},this.JST["templates/inventory.html"]=function(a){var b,c="";_.escape,Array.prototype.join;return c+='<div class="container inventoryContainer">\n    <div class="row">\n        <div class="col-sm-6 col-sm-offset-3">\n            <div class="well inventory-money-display">\n                <div class="input-group">\n                    <span class="input-group-addon"><i class="moneyIcon fa fa-money fa-2" aria-hidden="true"></i></span>\n                    <input readonly type="text" class="form-control" aria-label="Amount" value="'+(null==(b=a.money)?"":b)+'">\n                    ',a.money>=100&&(c+='\n                        <span class="input-group-btn">\n                            <button class="prizeGift btn btn-default" type="button"><i class="prizeGiftIcon fa fa-gift" aria-hidden="true"></i></button>\n                        </span>\n                    '),c+='\n                </div>\n            </div>\n        </div>\n    </div>\n    <div class="row">\n        ',_.each(a.inventoryItems,function(a){c+='\n            <div class="col-sm-6 col-md-4">\n                <div class="thumbnail inventoryItem box-shadow--4dp">\n                    <div class="inventory-image">\n                        <img src="'+(null==(b=a.item_image_location)?"":b)+'" />\n                    </div>\n                    <div class="caption">\n                        <h3>'+(null==(b=a.item_name)?"":b)+"</h3>\n                        <p>This is item #"+(null==(b=a.unique_id)?"":b)+" of the set!<br />You won this prize on "+(null==(b=a.timestamp)?"":b)+"</p>\n                    </div>\n                </div>\n            </div>\n        "}),c+='\n    </div><!-- row -->\n</div><!-- container -->\n\n<div id="payForPrizeModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="payForPrizeModal" aria-hidden="true">\n    <div class="modal-dialog">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n                <h4 class="modal-title" id="myModalLabel">Well, open it...</h4>\n            </div>\n            <div class="the-gift-cover text-center modal-body">\n                <i class="the-gift fa fa-gift fa-5"></i>\n            </div>\n            <div class="the-gift-reveal text-center modal-body">\n                <div class="well prize-well text-center"></div>\n                <div class="well money-well text-center"></div>\n            </div>\n            <div class="modal-footer">\n                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>\n            </div>\n        </div>\n    </div>\n</div>\n'},this.JST["templates/login.html"]=function(a){var b="";_.escape;return b+='<div class="container loginContainer">\n    <div class="row">\n        <div class="col-sm-6 col-sm-offset-3">\n            <form id="userLoginForm" class="form-signin">\n                <h2 class="form-signin-heading">Please sign in</h2>\n                <div class="form-group">\n                    <label for="inputUsername" class="sr-only">Username</label>\n                    <input type="text" id="inputUsername" class="form-control" placeholder="Username" required autofocus>\n                </div>\n                <div class="form-group">\n                    <label for="inputPassword" class="sr-only">Password</label>\n                    <input type="password" id="inputPassword" class="form-control" placeholder="Password" required>\n                </div>\n                <button class="btn btn-lg btn-primary btn-block" type="submit">Sign in</button>\n            </form>\n            <div class="error_msg text-center lead text-danger"></div>\n        </div>\n    </div>\n</div> <!-- /container -->\n'},this.JST["templates/register.html"]=function(a){var b="";_.escape;return b+='<div class="container">\n    <form class="form-signin">\n        <h2 class="form-signin-heading">Please sign in</h2>\n        <label for="inputEmail" class="sr-only">Email address</label>\n        <input type="email" id="inputEmail" class="form-control" placeholder="Email address" required autofocus>\n        <label for="inputPassword" class="sr-only">Password</label>\n        <input type="password" id="inputPassword" class="form-control" placeholder="Password" required>\n        <div class="checkbox">\n            <label>\n                <input type="checkbox" value="remember-me"> Remember me\n            </label>\n        </div>\n        <button class="btn btn-lg btn-primary btn-block" type="submit">Sign in</button>\n    </form>\n</div> <!-- /container -->\n'},this.JST["templates/timeline.html"]=function(a){var b,c="";_.escape,Array.prototype.join;return c+='<div class="container">\n    <div class="row">\n        <div class="col-md-8">\n            <div class="mapWrapper">\n                <div id="map-canvas" style="width: 100%; height: 400px;"></div>\n            </div>\n        </div><!--col-md-8-->\n        <div class="col-md-4">\n            <p>LAST SEEN AT:</p>\n            <h4 class="lastSeenLabel">'+(null==(b=a[0].name)?"":b)+"</h4>\n            "+(null==(b=a[0].review)?"":b)+'\n        </div><!--col-md-4-->\n    </div>\n</div><!-- container -->\n\n<div class="container">\n	<div class="row">\n		<div class="col-md-8 col-md-offset-2">\n			<div class="panel panel-default">\n                <div class="panel-body">\n                    <ul class="timeline">\n                        ',_.each(a,function(a,d){c+='\n                            <li class="',d%2==0&&(c+="timeline-inverted"),c+='">\n                                <div class="timeline-badge"><i class="fa fa-check"></i></div>\n                                <div class="timeline-panel">\n                                    <h4 class="timeline-title">'+(null==(b=a.name)?"":b)+"</h4>\n                                    ",_.isEmpty(a.review)||(c+="\n                                        <blockquote><p>"+(null==(b=a.review)?"":b)+"</p></blockquote>\n                                    "),c+='\n                                    <p><small><i class="fa fa-clock-o"></i>'+(null==(b=a.timestamp)?"":b)+"</small></p>\n                                </div>\n                            </li>\n                        "}),c+="\n                    </ul>\n                </div>\n            </div>\n		</div><!-- col-md-8 -->\n	</div><!-- row -->\n</div><!-- container -->\n"};var Checkin=Backbone.Model.extend({defaults:{},idAttribute:"ID",initialize:function(){this.on("invalid",function(a,b){console.log("We have an issue: "+b)})},constructor:function(a,b){Backbone.Model.apply(this,arguments)},urlRoot:"api/Checkins"}),Item=Backbone.Model.extend({defaults:{ID:0,name:"",image:""},idAttribute:"ID",initialize:function(){this.on("invalid",function(a,b){console.log("We have an issue: "+b)})},constructor:function(a,b){Backbone.Model.apply(this,arguments)},urlRoot:"api/Items"}),Place=Backbone.Model.extend({defaults:{id:0,name:"No Name",venue_id:""},initialize:function(){this.on("change:name",function(a){a.get("name")})},rename:function(a){this.set({name:a})}}),User=Backbone.Model.extend({defaults:{ID:0,username:"",loggedin:!1,money:0},idAttribute:"ID",initialize:function(){this.on("invalid",function(a,b){console.log("We have an issue: "+b)})},constructor:function(a,b){Backbone.Model.apply(this,arguments)},fetchUserMoney:function(){$.get(this.urlRoot+"/fetchUserMoney/"+this.id,_.bind(function(a){this.set({money:a.money})},this)).done(function(){}).fail(function(){}).always(function(){},"json")},handleUser:function(a){_.isNull(docCookies.getItem("userid"))||_.isNull(docCookies.getItem("usersession"))?(this.loggedin=!1,a()):$.get(this.urlRoot+"/checkLoginState",_.bind(function(b){b.loggedin&&(this.set({ID:b.id,loggedin:!0,username:b.username,money:b.money}),docCookies.setItem("userid",b.id,new Date((new Date).getTime()+6048e5)),docCookies.setItem("usersession",b.usersession,new Date((new Date).getTime()+6048e5)),this.setUserInterface("loggedin"),window.location.hash="checkin"),a()},this)).done(function(){}).fail(function(){}).always(function(){},"json")},userLogin:function(a){$.post(this.urlRoot+"/login",a,_.bind(function(a){a.loggedin?(this.set({ID:a.id,loggedin:!0,username:a.username,money:a.money}),docCookies.setItem("userid",a.id,new Date((new Date).getTime()+6048e5)),docCookies.setItem("usersession",a.usersession,new Date((new Date).getTime()+6048e5)),this.setUserInterface("loggedin"),window.location.hash="checkin"):$(router.container.myChildView.$el).find(".error_msg").html(a.message)},this)).done(function(){}).fail(function(){}).always(function(){})},setUserInterface:function(a){"loggedin"==a?$(".navbar .navbar-right").html('<li><a href="/#/logout">Logout</a></li>'):$(".navbar .navbar-right").html('<li><a href="/#/login">Login</a></li>')},getUserInventory:function(a){$.get(this.urlRoot+"/fetchInventory/"+this.get("ID"),_.bind(function(b){var c=new ItemsCollection(b.items);this.set({ownedItems:c,money:b.money}),a(b)},this)).done(function(){}).fail(function(){}).always(function(){},"json")},urlRoot:"api/Users"}),AppContainerView=Backbone.View.extend({myChildView:null,render:function(){return this.$el.html(this.myChildView.$el),this}}),CheckinView=Backbone.View.extend({template:JST["templates/checkin.html"],initialize:function(){this.venues=[],this.selectedVenue={},this.includedPhoto=!1,this.photoUUID="",this.render()},events:{"submit #existingLocationForm":"saveCheckin","click .include-checkin-photo":$("#checkin_photo").submit(),"click #BeginCheckin":"beginCheckin","click .fetchFromFoursquare .location-list .foursquare_venue":"openVenueDetails","change #include_photo_input":"handleIncludedPhoto"},render:function(){var a={search_label:"Here Now"},b=this.template(a);appUser.get("loggedin")?this.$el.html(b):(this.$el.html('<div class="container"><div class="row"><div class="col-sm-8 col-sm-offset-2 text-center">Please Login</div></div></div>'),window.location.hash="login")},getGeoInfo:function(a){if(navigator.geolocation)switch(a){case"foursquare":var b={timeout:31e3,enableHighAccuracy:!0,maximumAge:6e4};navigator.geolocation.getCurrentPosition(_.bind(this.fetchNearbyFoursquareVenues,this),this.geoError,b);break;case"current":navigator.geolocation.getCurrentPosition(showLocation)}else alert("Sorry, browser does not support geolocation!")},geoError:function(a){alert("Error 420 - Try Again"),$(".fetchFromFoursquare .loading-indicator").fadeOut()},fetchNearbyFoursquareVenues:function(a){latitude=a.coords.latitude,longitude=a.coords.longitude;var b=new Date,c=b.getFullYear(),d=("0"+(b.getMonth()+1)).slice(-2),e=("0"+b.getDate()).slice(-2),f="https://api.foursquare.com/v2/venues/search?ll="+latitude+","+longitude+"&client_id=C1LVPW1U2RT313HW4B0DRHFHSYFC2YQYTMUPZ0FF0SPVDDV2&client_secret=K2ZGG5FKKV24AVUTTQHKEA1UHNZKODSOYCDMWHVD2CQJ2IWP&v="+c+d+e;$.get(f,_.bind(function(a){fetchObj=a,$(".fetchFromFoursquare .loading-indicator").fadeOut(),$.each(a.response.venues,_.bind(function(a,b){this.venues.push(b),$(".fetchFromFoursquare .location-list").append('<a href="#" class="list-group-item foursquare_venue" data-venue-identifier="'+b.id+'" data-venue-index="'+a+'">'+b.name+"</a>")},this)),$(".fetchFromFoursquare .location-list").append('<a href="#" class="list-group-item new_venue">Venue not listed? Add it!</a>')},this)).done(function(){}).fail(function(){console.log("Error: Failed GET from Foursquare.")}).always(function(){},"json")},openVenueDetails:function(a){a.preventDefault(),chosen_venue_index=$(a.currentTarget).data("venueIndex"),chosen_venue_id=$(a.currentTarget).data("venueIdentifier"),this.selectedVenue=this.venues[chosen_venue_index],$("#foursquareModal .modal-header,#foursquareModal .modal-footer").show(),$("#foursquareModal .checkinMessageInput").val(""),$("#foursquareModal .modal-body.default-body").show(),$("#foursquareModal .modal-body.response-body").hide(),$("#foursquareModal .modal-header h4.modal-title").html(this.venues[chosen_venue_index].name),$("#foursquareModal .modal-body h3").html(this.venues[chosen_venue_index].location.formattedAddress[0]+"<br />"+this.venues[chosen_venue_index].location.formattedAddress[1]+"<br />"+this.venues[chosen_venue_index].location.formattedAddress[2]),$("#foursquareModal").modal()},beginCheckin:function(a){$(".fetchFromFoursquare .location-list").html(""),$(".fetchFromFoursquare .loading-indicator").css("display","inline-block"),this.getGeoInfo("foursquare")},saveCheckin:function(a){a.preventDefault();var b=new Checkin({user_id:appUser.get("ID"),foursquare_venue_id:this.selectedVenue.id,name:this.selectedVenue.name,latitude:this.selectedVenue.location.lat,longitude:this.selectedVenue.location.lng,review:_.isEmpty($(a.currentTarget).find(".checkinMessageInput").val())?null:$(a.currentTarget).find(".checkinMessageInput").val(),includedPhoto:this.includedPhoto,includedPhotoUUID:this.photoUUID});b.save({},{success:function(a,b,c){$(".fetchFromFoursquare .location-list").html(""),$("#foursquareModal .modal-footer").slideUp(),$("#foursquareModal .modal-body.response-body .prize-well").html(""),$("#foursquareModal .modal-body h3").html('<i class="fa fa-check-circle-o fa-3"></i> '+a.get("prize").message),$("#foursquareModal .modal-body.response-body .prize-well").html("<div>"+a.get("prize").message+"</div>"),a.get("prize").success&&$("#foursquareModal .modal-body.response-body .prize-well").append('<div class="prizeBox"><img src="'+a.get("prize").item.image+'" /><div class="item-name">'+a.get("prize").item.name+" #"+a.get("prize").item.unique+"</div></div>"),$("#foursquareModal .modal-body.response-body .money-well").html(""),$("#foursquareModal .modal-body.response-body .money-well").html("<div>"+a.get("prize").money+"</div>"),$("#foursquareModal .modal-body.default-body").fadeOut(),$("#foursquareModal .modal-body.response-body").fadeIn(),$(".loading-indicator").hide(),$("button#checkinSubmitBtn").show()},error:function(a,b,c){console.log("Something went wrong while saving the checkin")}})},handleIncludedPhoto:function(a){$(".existing_save").addClass("disabled");var b=uploadcare.fileFrom("object",a.currentTarget.files[0]);b.done(_bind(function(a){a.isStored&&(this.includedPhoto=!0,this.photoUUID=a.uuid,$(".include-checkin-photo-btn").removeClass("btn-primary").addClass("btn-success"),$(".include-checkin-photo-btn").html("").html('<i class="fa fa-camera-retro" aria-hidden="true"></i> Picture Added!'))},this)).fail(function(a,c){b.cancel(),alert("Photo Error: Please try again...")}),$(".existing_save").removeClass("disabled")}}),InventoryView=Backbone.View.extend({template:JST["templates/inventory.html"],initialize:function(){this.listenTo(appUser,"change:money",this.setMoney),appUser.getUserInventory(_.bind(function(a){this.itemData=a.items,this.money=a.money,this.render()},this))},events:{"click .prizeGift":"openPrizeModal","click .the-gift":"payForPrize"},render:function(){var a={};a.inventoryItems=this.itemData,a.money=appUser.get("money");var b=this.template(a);appUser.get("loggedin")?this.$el.html(b):(this.$el.html('<div class="container"><div class="row"><div class="col-sm-8 col-sm-offset-2 text-center">Please Login</div></div></div>'),window.location.hash="login")},payForPrize:function(){$("#payForPrizeModal .the-gift-reveal .prize-well").html(""),$("#payForPrizeModal .the-gift-reveal .money-well").html(""),$("#payForPrizeModal .the-gift-cover .the-gift").addClass("animated hinge"),$.get("api/Utilities/forcePrize/"+appUser.id,_.bind(function(a){$("#payForPrizeModal .modal-header h4").html("WOW! Nice find!"),$("#payForPrizeModal .the-gift-reveal .prize-well").html('<div class="prizeBox"><img src="'+a.prize.item.image+'" /><div class="item-name">'+a.prize.item.name+" #"+a.prize.item.unique+"</div></div>"),$("#payForPrizeModal .the-gift-reveal .money-well").html("<div>"+a.prize.money+"</div>"),$("#payForPrizeModal .the-gift-cover").fadeOut(),$("#payForPrizeModal .the-gift-reveal").fadeIn()},this)).done(function(){}).fail(function(){}).always(function(){},"json")},openPrizeModal:function(){$("#payForPrizeModal").on("hidden.bs.modal",function(){appUser.getUserInventory(function(){appUser.fetchUserMoney()})}),$("#payForPrizeModal").modal()},setMoney:function(){appUser.getUserInventory(_.bind(function(a){this.itemData=a.items,this.money=a.money,this.render()},this))}}),loginView=Backbone.View.extend({template:JST["templates/login.html"],initialize:function(){this.render()},events:{"submit #userLoginForm":"loginUser"},render:function(){var a={search_label:"Here Now"},b=this.template(a);this.$el.html(b)},loginUser:function(a){a.preventDefault(),$(router.container.myChildView.$el).find(".error_msg").html("");var b={username:$(a.currentTarget).find("#inputUsername").val(),password:$(a.currentTarget).find("#inputPassword").val()};appUser.userLogin(b)}}),RegisterView=Backbone.View.extend({template:JST["templates/register.html"],initialize:function(){this.render()},events:{},render:function(){var a={search_label:"Here Now"},b=this.template(a);this.$el.html(b)}}),MapView=Backbone.View.extend({template:JST["templates/timeline.html"],initialize:function(){},events:{},render:function(){if(appUser.get("loggedin")){var a=new CheckinsCollection;a.fetch({success:_.bind(function(a,b){var c=this.template(b);this.$el.html(c),this.plotCheckinPoints(b)},this)})}else this.$el.html('<div class="container"><div class="row"><div class="col-sm-8 col-sm-offset-2 text-center">Please Login</div></div></div>'),window.location.hash="login"},plotCheckinPoints:function(a){var b=new google.maps.LatLng(-25.363882,131.044922),c={zoom:8,center:b},d=new google.maps.Map(document.getElementById("map-canvas"),c);_.each(a,function(a){var b=new google.maps.LatLng(a.latitude,a.longitude),c=new google.maps.Marker({position:b,title:a.name});c.setMap(d)}),this.reCenter(d,a)},reCenter:function(a,b){var c=new google.maps.LatLngBounds;_.each(b,function(a){c.extend(new google.maps.LatLng(parseFloat(a.latitude),parseFloat(a.longitude)))}),a.setCenter(c.getCenter())}}),CheckinsCollection=Backbone.Collection.extend({model:Checkin,url:"api/Checkins"}),ItemsCollection=Backbone.Collection.extend({model:Item,url:"api/Items"}),MainRouter=Backbone.Router.extend({container:null,checkinView:null,timelineView:null,initialize:function(){this.container=new AppContainerView({el:$("#appContainer")}),this.bind("all",function(){$(".navbar-collapse").collapse("hide")})},routes:{"":"defaultIndex",checkin:"defaultIndex",timeline:"showTimeline",inventory:"showInventory",login:"showLogin",logout:"handleLogout",register:"showRegister"},defaultIndex:function(){null!=this.checkinView&&this.checkinView.remove(),this.checkinView=new CheckinView,this.container.myChildView=this.checkinView,this.container.render()},showTimeline:function(){null!=this.timelineView&&this.timelineView.remove(),this.timelineView=new MapView,this.container.myChildView=this.timelineView,this.container.render(),this.timelineView.render()},showInventory:function(){null!=this.InventoryView&&this.InventoryView.remove(),this.InventoryView=new InventoryView,this.container.myChildView=this.InventoryView,this.container.render()},showLogin:function(){null!=this.loginView&&this.loginView.remove(),this.loginView=new loginView,this.container.myChildView=this.loginView,this.container.render()},showRegister:function(){null!=this.registerView&&this.registerView.remove(),this.registerView=new registerView,this.container.myChildView=this.registerView,this.container.render()},handleLogout:function(){docCookies.removeItem("userid"),docCookies.removeItem("usersession"),appUser=new User({}),window.location.href="http://worldisending.com/#/login"}});$(document).ready(function(){router=new MainRouter,appUser=new User({}),appUser.handleUser(function(){Backbone.history.start()})});var docCookies={getItem:function(a){return a?decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(a).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null:null},setItem:function(a,b,c,d,e,f){if(!a||/^(?:expires|max\-age|path|domain|secure)$/i.test(a))return!1;var g="";if(c)switch(c.constructor){case Number:g=c===1/0?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+c;break;case String:g="; expires="+c;break;case Date:g="; expires="+c.toUTCString()}return document.cookie=encodeURIComponent(a)+"="+encodeURIComponent(b)+g+(e?"; domain="+e:"")+(d?"; path="+d:"")+(f?"; secure":""),!0},removeItem:function(a,b,c){return this.hasItem(a)?(document.cookie=encodeURIComponent(a)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(c?"; domain="+c:"")+(b?"; path="+b:""),!0):!1},hasItem:function(a){return a?new RegExp("(?:^|;\\s*)"+encodeURIComponent(a).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie):!1},keys:function(){for(var a=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/),b=a.length,c=0;b>c;c++)a[c]=decodeURIComponent(a[c]);return a}};
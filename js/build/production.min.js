this.JST=this.JST||{},this.JST["templates/checkin.html"]=function(a){var b,c="";_.escape;return c+='<div class="container">\n    <h2 class="widget-title text-center">Check In Here</h2>\n    <div class="row">\n        <div class="col-md-8 col-md-offset-2">\n            <div class="fetchFromFoursquare">\n                <p class="text-center">In this location, on this day, you did some awesome stuff...</p>\n                <p><button type="button" id="BeginCheckin" class="btn btn-block btn-lg">'+(null==(b=a.search_label)?"":b)+'</button></p>\n                <div class="text-center">\n                    <i class="loading-indicator fa fa-spinner fa-pulse fa-spin"></i>\n                </div>\n                <div class="list-group location-list"></div>\n            </div>\n        </div><!-- col-lg-8 -->\n    </div><!-- row -->\n</div><!-- container -->\n\n<div id="foursquareModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="foursqareModal" aria-hidden="true">\n	<form id="existingLocationForm" role="form">\n		<div class="modal-dialog">\n			<div class="modal-content">\n				<div class="modal-header">\n					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n					<h4 class="existingLocationName modal-title" id="myModalLabel"></h4>\n				</div>\n				<div class="modal-body default-body">\n					<div class="well">\n						<h3></h3>\n					</div>\n					<div class="well">\n						<i class="fa fa-bullhorn"></i> Got something to say?\n						<textarea id="CheckinMessageInput" class="checkinMessageInput form-control" rows="4"></textarea>\n					</div>\n				</div>\n				<div class="modal-body response-body">\n					<div class="well">\n						<h3></h3>\n					</div>\n					<div class="well prize-well">\n						<i class="fa fa-gift fa-3"></i> Prizes\n\n					</div>\n				</div>\n				<div class="modal-footer">\n					<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>\n					<button type="submit" class="existing_save btn btn-primary">Here</button>\n				</div>\n			</div>\n		</div>\n	</form>\n</div>\n'},this.JST["templates/timeline.html"]=function(a){var b,c="";_.escape,Array.prototype.join;return c+='<div class="container">\n    <div class="row">\n        <div class="col-md-8">\n            <div class="mapWrapper">\n                <div id="map-canvas" style="width: 100%; height: 400px;"></div>\n            </div>\n        </div><!--col-md-8-->\n        <div class="col-md-4">\n            <p>LAST SEEN AT:</p>\n            <h4 class="lastSeenLabel">PLACE NAME</h4>\n            --REVIEW--\n        </div><!--col-md-4-->\n    </div>\n</div><!-- container -->\n\n<div class="container">\n	<div class="row">\n		<div class="col-md-8 col-md-offset-2">\n			<div class="panel panel-default">\n                <div class="panel-body">\n                    <ul class="timeline">\n                        ',_.each(a,function(a,d){c+='\n                            <li class="',d%2==0&&(c+="timeline-inverted"),c+='">\n                                <div class="timeline-badge"><i class="fa fa-check"></i></div>\n                                <div class="timeline-panel">\n                                    <h4 class="timeline-title">'+(null==(b=a.name)?"":b)+"</h4>\n                                    ",_.isEmpty(a.review)||(c+="\n                                        <blockquote><p>"+(null==(b=a.review)?"":b)+"</p></blockquote>\n                                    "),c+='\n                                    <p><small><i class="fa fa-clock-o"></i>checkin.timestamp</small></p>\n                                </div>\n                            </li>\n                        '}),c+="\n                    </ul>\n                </div>\n            </div>\n		</div><!-- col-md-8 -->\n	</div><!-- row -->\n</div><!-- container -->\n"};var Checkin=Backbone.Model.extend({defaults:{},idAttribute:"ID",initialize:function(){this.on("invalid",function(a,b){console.log("We have an issue: "+b)})},constructor:function(a,b){Backbone.Model.apply(this,arguments)},urlRoot:"api/Checkins"}),Item=Backbone.Model.extend({defaults:{ID:0,name:"",image:""},idAttribute:"ID",initialize:function(){this.on("invalid",function(a,b){console.log("We have an issue: "+b)})},constructor:function(a,b){Backbone.Model.apply(this,arguments)},urlRoot:"api/Items"}),Place=Backbone.Model.extend({defaults:{id:0,name:"No Name",venue_id:""},initialize:function(){this.on("change:name",function(a){a.get("name")})},rename:function(a){this.set({name:a})}}),AppContainerView=Backbone.View.extend({myChildView:null,render:function(){return this.$el.html(this.myChildView.$el),this}}),CheckinView=Backbone.View.extend({template:JST["templates/checkin.html"],initialize:function(){this.venues=[],this.selectedVenue={},this.render()},events:{"submit #existingLocationForm":"saveCheckin","click #BeginCheckin":"beginCheckin","click .fetchFromFoursquare .location-list .foursquare_venue":"openVenueDetails"},render:function(){var a={search_label:"Here Now"},b=this.template(a);this.$el.html(b)},getGeoInfo:function(a){if(navigator.geolocation)switch(a){case"foursquare":var b={timeout:31e3,enableHighAccuracy:!0,maximumAge:6e4};navigator.geolocation.getCurrentPosition(_.bind(this.fetchNearbyFoursquareVenues,this),this.geoError,b);break;case"current":navigator.geolocation.getCurrentPosition(showLocation)}else alert("Sorry, browser does not support geolocation!")},geoError:function(a){alert("Error 420 - Try Again"),$(".fetchFromFoursquare .loading-indicator").fadeOut()},fetchNearbyFoursquareVenues:function(a){latitude=a.coords.latitude,longitude=a.coords.longitude;var b=new Date,c=b.getFullYear(),d=("0"+(b.getMonth()+1)).slice(-2),e=("0"+b.getDate()).slice(-2),f="https://api.foursquare.com/v2/venues/search?ll="+latitude+","+longitude+"&client_id=C1LVPW1U2RT313HW4B0DRHFHSYFC2YQYTMUPZ0FF0SPVDDV2&client_secret=K2ZGG5FKKV24AVUTTQHKEA1UHNZKODSOYCDMWHVD2CQJ2IWP&v="+c+d+e;$.get(f,_.bind(function(a){fetchObj=a,$(".fetchFromFoursquare .loading-indicator").hide(),$.each(a.response.venues,_.bind(function(a,b){this.venues.push(b),$(".fetchFromFoursquare .location-list").append('<a href="#" class="list-group-item foursquare_venue" data-venue-identifier="'+b.id+'" data-venue-index="'+a+'">'+b.name+"</a>")},this)),$(".fetchFromFoursquare .location-list").append('<a href="#" class="list-group-item new_venue">Venue not listed? Add it!</a>')},this)).done(function(){}).fail(function(){console.log("Error: Failed GET from Foursquare.")}).always(function(){},"json")},openVenueDetails:function(a){a.preventDefault(),chosen_venue_index=$(a.currentTarget).data("venueIndex"),chosen_venue_id=$(a.currentTarget).data("venueIdentifier"),this.selectedVenue=this.venues[chosen_venue_index],$("#foursquareModal .modal-header,#foursquareModal .modal-footer").show(),$("#foursquareModal .checkinMessageInput").val(""),$("#foursquareModal .modal-body.default-body").show(),$("#foursquareModal .modal-body.response-body").hide(),$("#foursquareModal .modal-header h4.modal-title").html(this.venues[chosen_venue_index].name),$("#foursquareModal .modal-body h3").html(this.venues[chosen_venue_index].location.formattedAddress[0]+"<br />"+this.venues[chosen_venue_index].location.formattedAddress[1]+"<br />"+this.venues[chosen_venue_index].location.formattedAddress[2]),$("#foursquareModal").modal()},beginCheckin:function(a){this.getGeoInfo("foursquare")},saveCheckin:function(a){a.preventDefault();var b=new Checkin({user_id:1,foursquare_venue_id:this.selectedVenue.id,name:this.selectedVenue.name,latitude:this.selectedVenue.location.lat,longitude:this.selectedVenue.location.lng,review:_.isEmpty($(a.currentTarget).find(".checkinMessageInput").val())?null:$(a.currentTarget).find(".checkinMessageInput").val()});b.save({},{success:function(a,b,c){console.log(a),$("#foursquareModal .modal-footer").slideUp(),$("#foursquareModal .modal-body.response-body .prize-well").html(""),$("#foursquareModal .modal-body h3").html('<i class="fa fa-check-circle-o fa-3"></i> '+a.get("prize").message),$("#foursquareModal .modal-body.response-body .prize-well").html("<div>"+a.get("prize").message+"</div>"),a.get("prize").success&&$("#foursquareModal .modal-body.response-body .prize-well").append('<div class="prizeBox"><img src="'+a.get("prize").item.image+'" /><div class="item-name">'+a.get("prize").item.name+" #"+a.get("prize").item.unique+"</div></div>"),$("#foursquareModal .modal-body.default-body").fadeOut(),$("#foursquareModal .modal-body.response-body").fadeIn(),$(".loading-indicator").hide(),$("button#checkinSubmitBtn").show()},error:function(a,b,c){console.log("Something went wrong while saving the checkin")}})}}),MapView=Backbone.View.extend({template:JST["templates/timeline.html"],initialize:function(){},events:{},render:function(){var a=new CheckinsCollection;a.fetch({success:_.bind(function(a,b){var c=this.template(b);this.$el.html(c),this.plotCheckinPoints(b)},this)})},plotCheckinPoints:function(a){var b=new google.maps.LatLng(-25.363882,131.044922),c={zoom:8,center:b},d=new google.maps.Map(document.getElementById("map-canvas"),c);_.each(a,function(a){var b=new google.maps.LatLng(a.latitude,a.longitude),c=new google.maps.Marker({position:b,title:a.name});c.setMap(d)}),this.reCenter(d,a)},reCenter:function(a,b){var c=new google.maps.LatLngBounds;_.each(b,function(a){c.extend(new google.maps.LatLng(parseFloat(a.latitude),parseFloat(a.longitude)))}),a.setCenter(c.getCenter())}}),CheckinsCollection=Backbone.Collection.extend({model:Checkin,url:"api/Checkins"}),MainRouter=Backbone.Router.extend({container:null,checkinView:null,timelineView:null,initialize:function(){this.container=new AppContainerView({el:$("#appContainer")})},routes:{"":"defaultIndex",timeline:"showTimeline"},defaultIndex:function(){null!=this.checkinView&&this.checkinView.remove(),this.checkinView=new CheckinView,this.container.myChildView=this.checkinView,this.container.render()},showTimeline:function(){null!=this.timelineView&&this.timelineView.remove(),this.timelineView=new MapView,this.container.myChildView=this.timelineView,this.container.render(),this.timelineView.render()}});$(document).ready(function(){router=new MainRouter,Backbone.history.start()});